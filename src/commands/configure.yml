description: Configure JFrog CLI with Artifactory server

parameters:
  url:
    type: string
    description: Artifactory URL (e.g., https://company.jfrog.io/artifactory)

  user:
    type: string
    description: JFrog username

  apikey:
    type: string
    description: JFrog API key or access token

  server-id:
    type: string
    default: circleci-rt
    description: Server ID for JFrog CLI configuration

steps:
  - run:
      name: Configure JFrog CLI
      command: |
        #!/bin/bash
        set -e
        
        SERVER_ID="<<parameters.server-id>>"
        URL="<<parameters.url>>"
        USER="<<parameters.user>>"
        APIKEY="<<parameters.apikey>>"
        
        # Validate required parameters
        if [ -z "$URL" ]; then
            echo "Error: Artifactory URL is required"
            exit 1
        fi
        
        if [ -z "$USER" ] || [ -z "$APIKEY" ]; then
            echo "Error: Username and API key are required"
            exit 1
        fi
        
        echo "Configuring JFrog CLI..."
        echo "Server ID: $SERVER_ID"
        echo "URL: $URL"
        echo "User: $USER"
        
        # Configure with access token (works for both API keys and access tokens)
        jf config add "$SERVER_ID" \
            --artifactory-url="$URL" \
            --user="$USER" \
            --access-token="$APIKEY" \
            --interactive=false \
            --overwrite
        
        echo "JFrog CLI configured successfully!"
        jf config show "$SERVER_ID"

